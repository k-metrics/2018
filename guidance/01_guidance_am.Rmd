---
title: "第１回データ分析勉強会"
author: "【午前の部】分析環境の構築と確認 [鈴木さんぽう, CC BY-NC-SA 4.0]"
date: "`r format(Sys.Date(), format = '%Y年%m月%d日')`"
output:
  ioslides_presentation:
    css: style.css
    df_print: paged
    logo: fig/hex-packrat.png
    smaller: false
    widescreen: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, message = FALSE)

require(tidyverse)
```


## 本日の内容
1. **分析環境の構築と確認（午前）**
    * Rのインストールと動作確認
    * Rtools（Windows環境のみ）とGitのインストール
    * RStudioのインストールと動作確認、オプション設定
    * packratパッケージのインストール
    * プロジェクトのインポートと動作確認
1. R Markdownで作る自己紹介（午後）
    * 自己紹介資料の作成
    * 作成した資料を用いた自己紹介


# 分析環境の構築と確認
## 利用OSでグループを分け
OSによりインストール方法などが異なりますので、環境構築時はOSごとにチームを分けます。R利用経験者は分散してサポートをお願いします。  

### Windows
* 一番人数が多いと思われるので1チーム3〜4人程度で

### macOS
* おそらく1チームで足りるかと人数が多ければ2チームで

### linux(Ubuntu)
* いないと思いますが...


## 必要なもの
* PC（無線LAN接続が可能なWindows, macOS, Ubuntu）
* R本体（3.4.4 or later）
* RStudio Desktop（1.1.423 or later）
* Rtools34（Windows Only）
* Git（利用OSに合わせて、Gitクライアントではありません）
* packartパッケージ

　  
今回、勉強会初（この手の勉強会としては本邦初？）の試みとして**GitHubリポジトリ**と**packrat**パッケージ**を用いた統一環境の作成を行います。ご利用の環境によっては、上手く環境作成ができない可能性もありますが、ご了承ください。


## Rのインストールと動作確認
環境を統一するためにRは本日時点での最新バージョン（R 3.x.x）を使います。追加パッケージも最新バージョンを使います。  

### Rのインストール
[Rのインストール方法](../cabinet/program/env_install.html)を参考にインストールを行ってください。macOSの方はサポーターの方からレクチャしてもらってください。  

### Rの動作確認
インストールが終わったらRのコンソールから以下を実行しグラフが表示されることを確認します。
```{r, eval=FALSE}
plot(iris)
```


## 動作確認結果
```{r}
plot(iris)
```


## リカバリタイム
うまく動作しない場合は動作環境などを確認しますのでサポートメンバー各位ご協力をお願いします。  

1. 何が動作しないのかを**説明して**ください
    * コンソールにメッセージが出ている場合はそれを教えてください
1. **管理者権限**で起動してみてください
1. それでも動かない場合は**Rのインストール先を変更**（Program Filesフォルダ以外の任意のフォルダへ）してみます
    * `C:\usr\bin\R`、`C:\R` など


## ツールのインストール（Windows Only）
Windows環境の方は**Rtools**というツール群をインストールしておきます。これはパッケージがzip形式で提供されていない場合に必要となるツール（コンパイラなど）です。

### Rtoolsのインストール
[Rtoolsのインストール方法](../cabinet/program/env_install_tls.html)を参考にインストールを行ってください。必ず**デフォルトのインストールパス**にインストールしてください。Windows環境以外の方はインストールの必要はありません。

### Rtoolsの動作確認
動作確認方法は特にありません。インストーラでエラーが出ていないことは確認しておいて下さい。


## Gitのインストール
今回はGitHubのリポジトリを利用しますので**Gitが必要**です（Gitクライアントではありません。また、GitHubアカウントも不要です）。  
Windowsの場合は[Git for Windows](https://gitforwindows.org/)をダウンロードしてインストールしてください。他のOSは公式リポジトリからインストールしてください。

### Gitのインストール
[自分用 Git For Windowsのインストール手順](https://qiita.com/toshi-click/items/dcf3dd48fdc74c91b409)を参考にインストールを行ってください。今回はGitHubからリポジトリをクローンするためだけに使いますので基本的にはデフォルト設定で構いません。

### Gitの設定
[Git for Windows インストール&設定](https://qiita.com/shinsumicco/items/a1c799640131ae33c792)を参考にユーザー名とメールアドレス設定ぐらいは行っておいてください。


# 休憩（５分）


# RStudioのインストールと動作確認

## 利用するバージョン
環境を統一するためにRStudioは本日時点での最新バージョン（v1.1.xxx）を使います。

### インストール先の確認
Rをデフォルトのインストール先から変更した方はRStudioのインストール先も変更しておいた方が無難です。なお、インストールには管理者権限が必要です。

1. Program Filesフォルダ（標準インストール先だが実行時に管理者権限要）
1. 上記を除く任意のフォルダ（面倒が少ないがUACが無効になる）
    * `C:\usr\bin\R`、`C:\R` など

### RStudioのインストール
インストーラを起動したら手順にしたがってインストールしてください。動作確認などはこの後で行います。


## RStuioの起動
インストールが完了したらRStudioを起動してください。Windows環境でCPU性能があまり高くない場合（第三世代 Core i3とか）は起動や動作が緩慢ですので、しばらく待ってみてください。それでも起動しない場合は、一度、強制終了さてて、再度起動してみてください。

### RStudioの概要説明
[RStudioの使い方](../cabinet/program/basics_rstudio.html)を参照しながら聞いてください。

### オプション設定
[RStudioの使い方](../cabinet/program/basics_rstudio.html)にしたがってオプション設定をします。オプション設定は推奨ですので必ずしもこの通りにする必要はありません。お好みで設定してください。


## パッケージのインストール
[パッケージのインストール方法](../cabinet/program/env_install_pkg.html#rstudioからインストールする方法)にしたがって以下の追加パッケージのインストールを行います。

* **packrat**

　  
**上記以外**のパッケージはこの時点で**インストールする必要はありません**。


## リカバリタイム
うまく動作しない場合は動作環境などを確認しますのでサポートメンバー各位ご協力をお願いします。  

1. 何が動作しないのかを**説明して**ください
    * コンソールにメッセージが出ている場合はそれを教えてください
1. **管理者権限**で起動してみてください
1. それでも動かない場合は**R/RStudioのインストール先を変更**（Program Filesフォルダ以外の任意のフォルダへ）してみます
    * `C:\usr\bin\R`、`C:\R` など


## プロジェクトの作成と動作確認
今回は前出の通りGitHubの公開リポジトリと**packrat**パッケージを利用して統一環境の準備を自動的に行うことを試みます。環境によっては上手く動かない可能性もありますが、ご了承ください。

### プロジェクトの作成（インポート）
1. ［File］-［New Project...］-［Version Control］-［Git］を選択します
1. 以下のURLを［Repository URL］に入力します
    * https://github.com/k-metrics/2018dasg.git
1. ［Project directory name］は**変更しない**でください
1. ［Create project as subdirectory of］は任意の場所で構いませんが**日本語や空白が含まれない**パスにしてください


## プロジェクトの作成（インポート）つづき
* 前述の入力が完了したら［Create Project］ボタンをクリックしてください
    * GitHubのリポジトリがクローニングされます
    * クローニング完了後自動的にプロジェクトが開かれます
    * コンソールに色々とエラーが出た場合でも気にしないでください
    * 必要なパッケージのダウンロードとインストールが自動的に始まります
    * 環境にもよりますが**15分前後の時間**がかかります
        * 気になるならシステムモニタを開いてください
    * "Packrat mode on. Using library in directory:"と表示されれば完了です
        * 完了メッセージ後もバックグラウンで色々やってるので**しばらく放置**します
        * 途中でエラーが出て再開させた場合は完了メッセージは表示されません
    * 念のためにRStudioを**再起動**させておきましょう


## リカバリタイム
* "Installing R package forim source requires install of additional build tools."と表示された
    1. ［No］をクリックし**RStudioを終了**させます
    1. Rtoolsを一旦削除し**デフォルトパスで再インストール**します
    1. プロジェクトフォルダを削除します
    1. RStudioを起動させ再度プロジェクトをインポートします
* 何かのエラーで止まったっぽい
    1. コンソールから**packrat::restore()**を実行してみてください
* 終わったみたいだけどパッケージが不足しているっぽい
    1. コンソールから**packrat::restore()**を実行してみてください


## 動作確認
### Rmdファイルのコンパイル
プロジェクトがインポートされたらR Markdownファイルをコンパイル（レンダリング）してみます。

1. ［Files］ペインで"template"フォルダを開きます
1. "Self-introduction.Rmd"をクリックして開きます
1. エディタにある［knitr］ボタンをクリックします
1. レンダリングが実行され別ウィンドウ（ペイン）に結果が表示されます


## License

CC BY-NC-SA 4.0, Sampo Suzuki